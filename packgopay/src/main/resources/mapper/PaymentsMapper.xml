<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pakgopay.mapper.PaymentsMapper">

    <resultMap id="PaymentsResultMap" type="com.pakgopay.mapper.dto.PaymentDto">

        <id     column="payment_id" property="paymentId" javaType="java.lang.Long"/>

        <result column="payment_name" property="paymentName" javaType="java.lang.String"/>
        <result column="support_type" property="supportType" javaType="java.lang.Integer"/>
        <result column="isThird" property="isThird" javaType="java.lang.String"/>

        <result column="payment_no" property="paymentNo" javaType="java.lang.Integer"/>

        <result column="payment_pay_rate" property="paymentPayRate" javaType="java.lang.String"/>
        <result column="payment_collection_rate" property="paymentCollectionRate" javaType="java.lang.String"/>

        <result column="payment_request_pay_url" property="paymentRequestPayUrl" javaType="java.lang.String"/>
        <result column="payment_request_collection_url" property="paymentRequestCollectionUrl" javaType="java.lang.String"/>

        <result column="payment_check_pay_url" property="paymentCheckPayUrl" javaType="java.lang.String"/>
        <result column="payment_check_collection_url" property="paymentCheckCollectionUrl" javaType="java.lang.String"/>

        <result column="payment_max_amount" property="paymentMaxAmount" javaType="java.math.BigDecimal"/>
        <result column="payment_min_amount" property="paymentMinAmount" javaType="java.math.BigDecimal"/>

        <result column="collection_daily_limit" property="collectionDailyLimit" javaType="java.math.BigDecimal"/>
        <result column="pay_daily_limit" property="payDailyLimit" javaType="java.math.BigDecimal"/>
        <result column="collection_monthly_limit" property="collectionMonthlyLimit" javaType="java.math.BigDecimal"/>
        <result column="pay_monthly_limit" property="payMonthlyLimit" javaType="java.math.BigDecimal"/>

        <result column="collection_interface_param" property="collectionInterfaceParam" javaType="java.lang.String"/>
        <result column="pay_interface_param" property="payInterfaceParam" javaType="java.lang.String"/>

        <result column="collection_callback_addr" property="collectionCallbackAddr" javaType="java.lang.String"/>
        <result column="pay_callback_addr" property="payCallbackAddr" javaType="java.lang.String"/>

        <result column="currency_type" property="currencyType" javaType="java.lang.String"/>

        <result column="create_time" property="createTime" javaType="java.lang.Long"/>
        <result column="create_by" property="createBy" javaType="java.lang.String"/>
        <result column="update_time" property="updateTime" javaType="java.lang.Long"/>
        <result column="update_by" property="updateBy" javaType="java.lang.Long"/>

        <result column="remark" property="remark" javaType="java.lang.String"/>

        <result column="is_checkout_counter" property="isCheckoutCounter" javaType="java.lang.Integer"/>
        <result column="checkout_counter_url" property="checkoutCounterUrl" javaType="java.lang.String"/>

        <result column="payment_type" property="paymentType" javaType="java.lang.String"/>
        <result column="bank_name" property="bankName" javaType="java.lang.String"/>
        <result column="bank_account" property="bankAccount" javaType="java.lang.String"/>
        <result column="bank_user_name" property="bankUserName" javaType="java.lang.String"/>
        <result column="status" property="status" javaType="java.lang.Integer"/>

    </resultMap>

    <sql id="BaseColumns">
        payment_id,
        payment_name,
        support_type,
        isThird,
        payment_no,
        payment_pay_rate,
        payment_collection_rate,
        payment_request_pay_url,
        payment_request_collection_url,
        payment_check_pay_url,
        payment_check_collection_url,
        payment_max_amount,
        payment_min_amount,
        collection_daily_limit,
        pay_daily_limit,
        collection_monthly_limit,
        pay_monthly_limit,
        collection_interface_param,
        pay_interface_param,
        collection_callback_addr,
        pay_callback_addr,
        currency_id,
        create_time,
        create_by,
        update_time,
        update_by,
        remark,
        is_checkout_counter,
        checkout_counter_url,
        payment_type,
        bank_name,
        bank_account,
        bank_user_name,
        status
    </sql>

    <!-- findEByPaymentNo -->
    <select id="findEByPaymentNo" resultMap="PaymentsResultMap">
        select
        <include refid="BaseColumns"/>
        from payment
        where payment_no = #{paymentNo}
    </select>

    <!-- findByPaymentId -->
    <select id="findByPaymentId" resultMap="PaymentsResultMap">
        select <include refid="BaseColumns"/>
        from payment
        where payment_id = #{paymentId}
        limit 1
    </select>

    <!-- getAllPayments -->
    <select id="getAllPayments" resultMap="PaymentsResultMap">
        select <include refid="BaseColumns"/>
        from payment
        order by create_time desc
    </select>

    <!-- insert -->
    <insert id="insert" parameterType="com.pakgopay.mapper.dto.PaymentDto">
        insert into payment (
        <include refid="BaseColumns"/>
        ) values (
        #{paymentId},
        #{paymentName},
        #{supportType},
        #{payEnable},
        #{isThird},
        #{paymentNo},
        #{paymentPayRate},
        #{paymentCollectionRate},
        #{paymentRequestPayUrl},
        #{paymentRequestCollectionUrl},
        #{paymentCheckPayUrl},
        #{paymentCheckCollectionUrl},
        #{paymentMaxAmount},
        #{paymentMinAmount},
        #{collectionDailyLimit},
        #{payDailyLimit},
        #{collectionMonthlyLimit},
        #{payMonthlyLimit},
        #{collectionInterfaceParam},
        #{payInterfaceParam},
        #{collectionCallbackAddr},
        #{payCallbackAddr},
        #{currencyType},
        #{createTime},
        #{createBy},
        #{updateTime},
        #{updateBy},
        #{remark},
        #{isCheckoutCounter},
        #{checkoutCounterUrl},
        #{paymentType},
        #{bankName},
        #{bankAccount},
        #{bankUserName},
        #{status}
        )
    </insert>

    <!-- updateByPaymentId -->
    <update id="updateByPaymentId" parameterType="com.pakgopay.mapper.dto.PaymentDto">
        update payment
        set
            payment_name = #{paymentName},
            support_type = #{supportType},
            isThird = #{isThird},
            payment_no = #{paymentNo},
            payment_pay_rate = #{paymentPayRate},
            payment_collection_rate = #{paymentCollectionRate},
            payment_request_pay_url = #{paymentRequestPayUrl},
            payment_request_collection_url = #{paymentRequestCollectionUrl},
            payment_check_pay_url = #{paymentCheckPayUrl},
            payment_check_collection_url = #{paymentCheckCollectionUrl},
            payment_max_amount = #{paymentMaxAmount},
            payment_min_amount = #{paymentMinAmount},
            collection_daily_limit = #{collectionDailyLimit},
            pay_daily_limit = #{payDailyLimit},
            collection_monthly_limit = #{collectionMonthlyLimit},
            pay_monthly_limit = #{payMonthlyLimit},
            collection_interface_param = #{collectionInterfaceParam},
            pay_interface_param = #{payInterfaceParam},
            collection_callback_addr = #{collectionCallbackAddr},
            pay_callback_addr = #{payCallbackAddr},
            currency_type = #{currencyType},
            update_time = #{updateTime},
            update_by = #{updateBy},
            remark = #{remark},
            is_checkout_counter = #{isCheckoutCounter},
            checkout_counter_url = #{checkoutCounterUrl},
            payment_type = #{paymentType},
            bank_name = #{bankName},
            bank_account = #{bankAccount},
            bank_user_name = #{bankUserName},
            status = #{status}
        where payment_id = #{paymentId}
    </update>

    <!-- deleteByPaymentId -->
    <delete id="deleteByPaymentId">
        delete from payment
        where payment_id = #{paymentId}
    </delete>

    <select id="findEnableInfoByPaymentNos" resultMap="PaymentsResultMap">
        select
        <include refid="BaseColumns"/>
        from payment
        where payment_no = #{paymentNo}
        <if test="paymentIdList != null and !paymentIdList.isEmpty()">
            and payment_id in
            <foreach collection="paymentIdList" item="pid" open="(" close=")" separator=",">
                #{pid}
            </foreach>
        </if>
        and (status = 1)
        and support_type IN (2, #{supportType})
    </select>


</mapper>
